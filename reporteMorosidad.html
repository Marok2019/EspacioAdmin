<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Deudores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="reporteMorosidadStyles.css">
</head>
<body class="bg-dark">
    <div class="header-container d-flex align-items-center">
        <img src="https://i.ibb.co/FW5SBG3/logo-no-background.png" alt="Logo" class="header-logo">
        <button type="button" class="btn btn-danger logout-button">Cerrar Sesión</button>
    </div>

    <div class="container mt-5">
        <h1 class="text-center text-white mb-4">Consulta de Deudores</h1>

        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="condominiumSelect" class="form-label text-white">Seleccione el Condominio:</label>
                    <select class="form-select" id="condominiumSelect" aria-label="Seleccione el Condominio">
                        <option selected>Seleccione un condominio</option>
                        <option value="condominio1">Condominio 1</option>
                        <option value="condominio2">Condominio 2</option>
                        <option value="condominio3">Condominio 3</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="rutInput" class="form-label text-white">Ingrese el RUT:</label>
                    <input type="text" class="form-control" id="rutInput" placeholder="88.888.888-8">
                </div>
            </div>
        </div>

        <div class="row justify-content-center mb-4">
            <div class="col-md-6">
                <button type="button" class="btn btn-primary w-100" onclick="searchDebtors()">Buscar</button>
                <button type="button" class="btn btn-warning w-100 mt-2" onclick="downloadReport()">Descargar Reporte</button>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-12">
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>RUT</th>
                            <th>Condominio</th>
                            <th>Monto</th>
                            <th>Estado del Pago</th>
                            <th>Fecha de Vencimiento</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="debtorTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="bg-dark py-3 mt-5">
        <div class="container">
            <p class="text-center text-white">&copy; <span id="current-year"></span> Todos los derechos reservados</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('current-year').textContent = new Date().getFullYear();

        function searchDebtors() {
            const condominium = document.getElementById('condominiumSelect').value;
            const rut = document.getElementById('rutInput').value;

            if (condominium !== 'Seleccione un condominio' && rut !== '') {
                // Simulate API call to fetch debtor data
                const mockData = [
                    { name: 'Juan Pérez', rut: '88.888.888-8', condominium: 'Condominio 1', amount: 1500, paymentStatus: 'Pendiente', dueDate: '2023-03-15', actions: ['Ver Detalles', 'Notificar'] },
                    { name: 'María García', rut: '99.999.999-9', condominium: 'Condominio 2', amount: 2000, paymentStatus: 'Pagado', dueDate: '2023-04-01', actions: ['Ver Detalles', 'Notificar'] },
                    { name: 'Carlos López', rut: '77.777.777-7', condominium: 'Condominio 3', amount: 2500, paymentStatus: 'Vencido', dueDate: '2023-02-28', actions: ['Ver Detalles', 'Notificar', 'Pagar'] }
                ];

                populateDebtorTable(mockData);
            } else {
                alert('Por favor, seleccione un condominio y ingrese un RUT válido.');
            }
        }

        function downloadReport() {
            // Simulate report download
            const link = document.createElement('a');
            const reportData = `
                <table>
                    <tr><th>Nombre</th><th>RUT</th><th>Condominio</th><th>Monto</th><th>Estado del Pago</th><th>Fecha de Vencimiento</th><th>Acciones</th></tr>
                    <tr><td>Juan Pérez</td><td>88.888.888-8</td><td>Condominio 1</td><td>1500</td><td>Pendiente</td><td>2023-03-15</td><td>Ver Detalles, Notificar</td></tr>
                    <tr><td>María García</td><td>99.999.999-9</td><td>Condominio 2</td><td>2000</td><td>Pagado</td><td>2023-04-01</td><td>Ver Detalles, Notificar</td></tr>
                    <tr><td>Carlos López</td><td>77.777.777-7</td><td>Condominio 3</td><td>2500</td><td>Vencido</td><td>2023-02-28</td><td>Ver Detalles, Notificar, Pagar</td></tr>
                </table>
            `;
            link.href = 'data:text/html;charset=utf-8,' + encodeURIComponent(reportData);
            link.download = 'reporte_deudores.pdf';
            link.click();
        }

        function populateDebtorTable(data) {
            const tbody = document.getElementById('debtorTableBody');
            tbody.innerHTML = ''; // Clear existing rows
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.rut}</td>
                    <td>${item.condominium}</td>
                    <td>$${item.amount}</td>
                    <td>${item.paymentStatus}</td>
                    <td>${item.dueDate}</td>
                    <td>${item.actions.join(', ')}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>
