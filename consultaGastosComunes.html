<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Gastos Comunes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="consultaGastosComunesStyles.css">
</head>
<body class="bg-dark">
    <div class="header-container d-flex align-items-center">
        <img src="https://i.ibb.co/FW5SBG3/logo-no-background.png" alt="Logo" class="header-logo">
        <button type="button" class="btn btn-danger logout-button">Cerrar Sesión</button>
    </div>

    <div class="container mt-5">
        <h1 class="text-center text-white mb-4">Consulta de Gastos Comunes</h1>

        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="condominiumSelect" class="form-label text-white">Seleccione el Condominio:</label>
                    <select class="form-select" id="condominiumSelect" aria-label="Seleccione el Condominio">
                        <option selected>Seleccione un condominio</option>
                        <option value="condominio1">Condominio 1</option>
                        <option value="condominio2">Condominio 2</option>
                        <option value="condominio3">Condominio 3</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="mb-3">
                    <label for="rutInput" class="form-label text-white">Ingrese el RUT:</label>
                    <input type="text" class="form-control" id="rutInput" placeholder="88.888.888-8">
                </div>
            </div>
        </div>

        <div class="row justify-content-center mb-4">
            <div class="col-md-6">
                <button type="button" class="btn btn-primary w-100" onclick="searchTaxes()">Buscar</button>
                <button type="button" class="btn btn-warning w-100 mt-2" onclick="downloadReport()">Descargar Reporte</button>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-12">
                <table class="table table-dark table-striped">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>RUT</th>
                            <th>Condominio</th>
                            <th>Impuesto Agua</th>
                            <th>Impuesto Gas</th>
                            <th>Impuesto Luz</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="taxesTableBody">
                        <!-- Data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer class="bg-dark py-3 mt-5">
        <div class="container">
            <p class="text-center text-white">&copy; <span id="current-year"></span> Todos los derechos reservados</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('current-year').textContent = new Date().getFullYear();

        function searchTaxes() {
            const condominium = document.getElementById('condominiumSelect').value;
            const rut = document.getElementById('rutInput').value;

            if (condominium !== 'Seleccione un condominio' && rut !== '') {
                // Simulate API call to fetch data
                const mockData = [
                    { name: 'Juan Pérez', rut: '88.888.888-8', condominium: 'Condominio 1', waterTax: 5000, gasTax: 3000, electricityTax: 4000, total: 12000 },
                    { name: 'María García', rut: '99.999.999-9', condominium: 'Condominio 2', waterTax: 6000, gasTax: 3500, electricityTax: 4500, total: 14000 },
                    { name: 'Carlos López', rut: '77.777.777-7', condominium: 'Condominio 3', waterTax: 5500, gasTax: 3200, electricityTax: 4200, total: 12900 }
                ];

                populateTaxesTable(mockData);
            } else {
                alert('Por favor, seleccione un condominio y ingrese un RUT válido.');
            }
        }

        function downloadReport() {
            // Simulate report download
            const link = document.createElement('a');
            const reportData = `
                <table>
                    <tr><th>Nombre</th><th>RUT</th><th>Condominio</th><th>Impuesto Agua</th><th>Impuesto Gas</th><th>Impuesto Luz</th><th>Total</th></tr>
                    <tr><td>Juan Pérez</td><td>88.888.888-8</td><td>Condominio 1</td><td>5000</td><td>3000</td><td>4000</td><td>12000</td></tr>
                    <tr><td>María García</td><td>99.999.999-9</td><td>Condominio 2</td><td>6000</td><td>3500</td><td>4500</td><td>14000</td></tr>
                    <tr><td>Carlos López</td><td>77.777.777-7</td><td>Condominio 3</td><td>5500</td><td>3200</td><td>4200</td><td>12900</td></tr>
                </table>
            `;
            link.href = 'data:text/html;charset=utf-8,' + encodeURIComponent(reportData);
            link.download = 'reporte_ggcc.xlsx';
            link.click();
        }

        function populateTaxesTable(data) {
            const tbody = document.getElementById('taxesTableBody');
            tbody.innerHTML = ''; // Clear existing rows
            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.rut}</td>
                    <td>${item.condominium}</td>
                    <td>$${item.waterTax}</td>
                    <td>$${item.gasTax}</td>
                    <td>$${item.electricityTax}</td>
                    <td>$${item.total}</td>
                `;
                tbody.appendChild(row);
            });
        }
    </script>
</body>
</html>
